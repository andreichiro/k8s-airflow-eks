- name: ubbagent
  image: {{ .Values.ubbAgent.image }}
  imagePullPolicy: {{ .Values.ubbAgent.pullPolicy | default "IfNotPresent" }}
  env:
    - name: AGENT_CONFIG_FILE
      value: "/etc/ubbagent/config.yaml"
    - name: AGENT_LOCAL_PORT
      value: "6080"
    - name: AGENT_STATE_DIR
      value: "/var/lib/ubbagent"
    - name: AGENT_REPORT_DIR
      value: "/var/lib/ubbagent/reports"
    - name: AGENT_ENCODED_KEY
      valueFrom:
        secretKeyRef:
          name: {{ .Values.reportingSecret }}
          key: reporting-key
    - name: AGENT_CONSUMER_ID
      valueFrom:
        secretKeyRef:
          name: {{ .Values.reportingSecret }}
          key: consumer-id
  volumeMounts:
    - name: ubbagent-config
      mountPath: /etc/ubbagent/config.yaml
      subPath: config.yaml
    - name: ubbagent-state
      mountPath: /var/lib/ubbagent